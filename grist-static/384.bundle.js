"use strict";(self.webpackChunkgristy=self.webpackChunkgristy||[]).push([[384],{54384:(e,t,n)=>{n.r(t),n.d(t,{AccountPage:()=>le,checkName:()=>ce});var i=n(38109),a=n(3988),o=n(29922),s=n(7454),r=n(1310);const l=(0,r.styled)("div","\n  display: flex;\n  justify-content: center;\n  overflow: auto;\n"),d=(0,r.styled)("div","\n  max-width: 600px;\n  margin-top: auto;\n  margin-bottom: auto;\n  padding: 16px;\n"),c=(0,r.styled)("div","\n  flex: 1 1 300px;\n"),h=(0,r.styled)("button",`\n  font-size: ${o.vars.mediumFontSize};\n  color: ${o.theme.controlFg};\n  cursor: pointer;\n  margin-left: 16px;\n  background-color: transparent;\n  border: none;\n  padding: 0;\n  text-align: left;\n  min-width: 110px;\n\n  &:hover {\n    color: ${o.theme.controlHoverFg};\n  }\n`),p=(0,r.styled)(s.icon,`\n  background-color: ${o.theme.controlFg};\n  margin: 0 4px 2px 0;\n\n  .${h.className}:hover > & {\n    background-color: ${o.theme.controlHoverFg};\n  }\n`),u=(0,r.styled)("div",`\n  color: ${o.theme.lightText};\n  font-size: 13px;\n`),m=(0,r.styled)("div","\n  flex-grow: 1;\n"),g=(0,r.styled)(m,`\n  color: ${o.theme.text};\n  word-break: break-word;\n`),y=(0,r.styled)("div",`\n  color: ${o.theme.text};\n  word-break: break-word;\n`),_=(0,r.styled)(m,`\n  color: ${o.theme.text};\n  word-break: break-word;\n`),b=(0,r.styled)("div",`\n  color: ${o.theme.errorText};\n`),w=(0,r.styled)("div",`\n  height: 32px;\n  line-height: 32px;\n  margin: 28px 0 16px 0;\n  color: ${o.theme.text};\n  font-size: ${o.vars.xxxlargeFontSize};\n  font-weight: ${o.vars.headerControlTextWeight};\n`),v=(0,r.styled)("div",`\n  color: ${o.theme.text};\n  padding: 8px 0;\n  vertical-align: top;\n  font-weight: bold;\n  display: block;\n`),f=(0,r.styled)(v,"\n  display: inline-block;\n  min-width: 110px;\n"),x=(0,r.styled)("div","\n  margin: 8px 0px;\n  display: flex;\n  align-items: baseline;\n  gap: 2px;\n"),k=(0,r.styled)("span",`\n  text-transform: uppercase;\n  vertical-align: super;\n  font-size: ${o.vars.xsmallFontSize};\n  color: ${o.theme.accentText};\n`);var A=n(70387),P=n(11187),C=n(20742);const O=(0,A.makeT)("ApiKey"),K=(0,r.makeTestId)("test-apikey-");class M extends r.Disposable{constructor(e){var t;super(),this._loading=(0,r.observable)(!1),this._isHidden=r.Observable.create(this,!0),this._apiKey=e.apiKey,this._onDeleteCB=e.onDelete,this._onCreateCB=e.onCreate,this._anonymous=Boolean(e.anonymous),this._inputArgs=null!=(t=e.inputArgs)?t:[]}buildDom(){return(0,r.dom)("div",K("container"),r.dom.style("position","relative"),r.dom.maybe(this._apiKey,(e=>(0,r.dom)("div",T($({readonly:!0,value:this._apiKey.get()},r.dom.attr("type",(e=>e(this._isHidden)?"password":"text")),K("key"),{title:O("Click to show")},r.dom.on("click",((e,t)=>{this._isHidden.set(!1),setTimeout((()=>t.select()),0)})),r.dom.on("blur",(e=>{e.target!==document.activeElement&&this._isHidden.set(!0)})),this._inputArgs),S(E("Remove"),O("Remove"),r.dom.on("click",(()=>this._showRemoveKeyModal())),K("delete"),r.dom.boolAttr("disabled",(e=>e(this._loading)||this._anonymous)))),D(this._getDescription(),K("description"))))),r.dom.maybe((e=>!(e(this._apiKey)||this._anonymous)),(()=>[(0,P.basicButton)(O("Create"),r.dom.on("click",(()=>this._onCreate())),K("create"),r.dom.boolAttr("disabled",this._loading)),D(O("By generating an API key, you will be able to make API calls for your own account."),K("description"))])))}async _switchLoadingFlag(e){this._loading.set(!0);try{await e}finally{this._loading.set(!1)}}_onDelete(){return this._switchLoadingFlag(this._onDeleteCB())}_onCreate(){return this._switchLoadingFlag(this._onCreateCB())}_getDescription(){return O(this._anonymous?"This API key can be used to access this account anonymously via the API.":"This API key can be used to access your account via the API. Donâ€™t share your API key with anyone.")}_showRemoveKeyModal(){(0,C.confirmModal)(O("Remove API Key"),O("Remove"),(()=>this._onDelete()),{explanation:O("You're about to delete an API key. This will cause all future requests using this API key to be rejected. Do you still want to delete?")})}}const D=(0,r.styled)("div",`\n  margin-top: 8px;\n  color: ${o.theme.lightText};\n  font-size: ${o.vars.mediumFontSize};\n`),$=(0,r.styled)("input",`\n  background-color: transparent;\n  color: ${o.theme.inputFg};\n  border: 1px solid ${o.theme.inputBorder};\n  padding: 4px;\n  border-radius: 3px;\n  outline: none;\n  flex: 1 0 0;\n`),T=(0,r.styled)("div","\n  display: flex;\n"),S=(0,r.styled)(P.textButton,"\n  text-align: left;\n  width: 90px;\n  margin-left: 16px;\n"),E=(0,r.styled)(s.icon,"\n  margin: 0 4px 2px 0;\n");var I=n(31077),N=n(24894);class F extends r.Disposable{constructor(e){super()}buildDom(){return null}}var L=n(39706),W=n(92478),z=n(1370),B=Object.defineProperty,G=Object.defineProperties,H=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable,V=(e,t,n)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Y=(e,t)=>{for(var n in t||(t={}))j.call(t,n)&&V(e,n,t[n]);if(U)for(var n of U(t))R.call(t,n)&&V(e,n,t[n]);return e},q=(e,t)=>G(e,H(t));const J=(0,r.makeTestId)("test-theme-config-"),Q=(0,A.makeT)("ThemeConfig");class X extends r.Disposable{constructor(e){super(),this._appModel=e,this._themePrefs=this._appModel.themePrefs,this._appearance=r.Computed.create(this,this._themePrefs,((e,t)=>t.appearance)).onWrite((e=>this._updateAppearance(e))),this._syncWithOS=r.Computed.create(this,this._themePrefs,((e,t)=>t.syncWithOS)).onWrite((e=>this._updateSyncWithOS(e)))}buildDom(){return(0,r.dom)("div",v(Q("Appearance "),k("Beta")),x(Z((0,z.select)(this._appearance,[{value:"light",label:"Light"},{value:"dark",label:"Dark"}]),J("appearance"))),x((0,W.rp)(this._syncWithOS,Q("Switch appearance automatically to match system"),J("sync-with-os"))),J("container"))}_updateAppearance(e){this._themePrefs.set(q(Y({},this._themePrefs.get()),{appearance:e}))}_updateSyncWithOS(e){this._themePrefs.set(q(Y({},this._themePrefs.get()),{syncWithOS:e}))}}const Z=(0,r.styled)("div","\n  width: 120px;\n");var ee=n(46077),te=n(68370),ne=n(20959),ie=n(4425),ae=n(36322),oe=n(44341);const se=(0,r.makeTestId)("test-account-page-"),re=(0,A.makeT)("AccountPage");class le extends r.Disposable{constructor(e){super(),this._appModel=e,this._apiKey=r.Observable.create(this,""),this._userObs=r.Observable.create(this,null),this._isEditingName=r.Observable.create(this,!1),this._nameEdit=r.Observable.create(this,""),this._isNameValid=r.Computed.create(this,this._nameEdit,((e,t)=>ce(t))),this._allowGoogleLogin=r.Computed.create(this,(e=>{var t,n;return null!=(n=null==(t=e(this._userObs))?void 0:t.allowGoogleLogin)&&n})).onWrite((e=>this._updateAllowGooglelogin(e))),this._fetchAll().catch(i.eK)}buildDom(){const e=r.Observable.create(this,!1);return(0,L.J)({leftPanel:{panelWidth:r.Observable.create(this,240),panelOpen:e,hideOpener:!0,header:r.dom.create(I.t,this._appModel),content:(0,N.I$)(this._appModel,e)},headerMain:this._buildHeaderMain(),contentMain:this._buildContentMain(),testId:se})}_buildContentMain(){var e;const{enableCustomCss:t}=(0,ae.getGristConfig)(),n=null!=(e=(0,ae.getGristConfig)().supportedLngs)?e:["en"],i=n.map((e=>({value:e,label:(0,oe.c)(e)}))).sort(((e,t)=>e.value.localeCompare(t.value))),a=r.Computed.create(this,(e=>{const t=(0,A.detectCurrentLang)();return n.includes(t)?t:"en"}));return a.onWrite((async e=>{await this._appModel.api.updateUserLocale(e||null),window.location.reload()})),(0,r.domComputed)(this._userObs,(e=>e&&l(d(w(re("Account settings")),x(f(re("Email")),y(e.email)),x(f(re("Name")),(0,r.domComputed)(this._isEditingName,(t=>t?[(0,te.o)({initialValue:e.name,save:e=>this._isNameValid.get()&&this._updateUserName(e),close:()=>{this._isEditingName.set(!1),this._nameEdit.set("")}},{size:"5"},r.dom.on("input",((e,t)=>this._nameEdit.set(t.value))),m.cls("")),h(p("Settings"),re("Save"))]:[g(e.name),h(p("Settings"),re("Edit"),r.dom.on("click",(()=>this._isEditingName.set(!0))))])),se("username")),r.dom.maybe((e=>e(this._nameEdit)&&!e(this._isNameValid)),this._buildNameWarningsDom.bind(this)),w(re("Password & Security")),x(f(re("Login Method")),_(e.loginMethod),"Email + Password"===e.loginMethod?h(re("Change Password"),r.dom.on("click",(()=>this._showChangePasswordDialog()))):null,se("login-method")),"Email + Password"!==e.loginMethod?null:r.dom.frag(x((0,W.rp)(this._allowGoogleLogin,re("Allow signing in to this account with Google"),se("allow-google-login-checkbox")),se("allow-google-login")),v(re("Two-factor authentication")),u(re("Two-factor authentication is an extra layer of security for your Grist account designed to ensure that you're the only person who can access your account, even if someone knows your password.")),r.dom.create(F,e)),w(re("Theme")),t?null:r.dom.create(X,this._appModel),v(re("Language")),x({style:"width: 300px"},(0,z.select)(a,i,{renderOptionArgs:()=>r.dom.cls(pe.className)}),se("language")),w(re("API")),x(f(re("API Key")),c(r.dom.create(M,{apiKey:this._apiKey,onCreate:()=>this._createApiKey(),onDelete:()=>this._deleteApiKey(),anonymous:!1,inputArgs:[{size:"5"}]})))),se("body"))))}_buildHeaderMain(){return r.dom.frag((0,ne.xn)({style:"margin-left: 16px;"},(0,ie.Y3)((0,a.urlState)().setLinkUrl({}),"Home",se("home")),(0,ne.kr)(" / "),(0,r.dom)("span","Account")),(0,ee._)(this._appModel))}async _fetchApiKey(){this._apiKey.set(await this._appModel.api.fetchApiKey())}async _createApiKey(){this._apiKey.set(await this._appModel.api.createApiKey())}async _deleteApiKey(){await this._appModel.api.deleteApiKey(),this._apiKey.set("")}async _fetchUserProfile(){this._userObs.set(await this._appModel.api.getUserProfile())}async _fetchAll(){await Promise.all([this._fetchApiKey(),this._fetchUserProfile()])}async _updateUserName(e){const t=this._userObs.get();t&&e&&e===t.name||(await this._appModel.api.updateUserName(e),await this._fetchAll())}async _updateAllowGooglelogin(e){await this._appModel.api.updateAllowGoogleLogin(e),await this._fetchUserProfile()}_showChangePasswordDialog(){return null}_buildNameWarningsDom(){return he(re("Names only allow letters, numbers and certain special characters"),se("username-warning"))}}const de=/^(\w|[^\u0000-\u007F])(\w|[- ./'"()]|[^\u0000-\u007F])*$/;function ce(e){return de.test(e)}const he=(0,r.styled)(b,"\n  margin: -8px 0 0 110px;\n"),pe=(0,r.styled)("div","\n  & > div::first-letter {\n    text-transform: capitalize;\n  }\n")},68370:(e,t,n)=>{n.d(t,{o:()=>s});var i=n(38109),a=n(29922),o=n(1310);function s({initialValue:e,save:t,close:n},...a){let s=e;async function l(e){try{(e||c.value!==s)&&(s=c.value,await t(c.value)),n()}catch(e){(0,i.eK)(e),d()}}function d(){setTimeout((()=>{c.focus(),c.select()}),10)}const c=r({type:"text",placeholder:"Enter name"},o.dom.prop("value",e),o.dom.on("blur",(()=>l(!1))),o.dom.onKeyDown({Enter:()=>l(!0),Escape:()=>n()}),...a);return d(),c}const r=(0,o.styled)("input",`\n  background-color: transparent;\n  color: ${a.theme.inputFg};\n\n  &::placeholder {\n    color: ${a.theme.inputPlaceholderFg};\n  }\n`)}}]);
//# sourceMappingURL=384.bundle.js.map