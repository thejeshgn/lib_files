{"version":3,"file":"app_client_components_ViewPane_ts.bundle.js","mappings":"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","sources":["./app/client/components/ViewPane.ts?","./app/client/ui/SortFilterConfig.ts?","./app/client/components/ViewConfigTab.js?"],"sourcesContent":["// This module is unused except to group some modules for a webpack bundle.\n// TODO It is a vestige of the old ViewPane.js, and can go away with some bundling improvements.\n\nimport ViewConfigTab from 'app/client/components/ViewConfigTab';\nimport * as FieldConfig from 'app/client/ui/FieldConfig';\nexport {ViewConfigTab, FieldConfig};\nexport {ConditionalStyle} from 'app/client/widgets/ConditionalStyle';\n","import {GristDoc} from 'app/client/components/GristDoc';\nimport {makeT} from 'app/client/lib/localization';\nimport {ViewSectionRec} from 'app/client/models/DocModel';\nimport {FilterConfig} from 'app/client/ui/FilterConfig';\nimport {cssLabel, cssSaveButtonsRow} from 'app/client/ui/RightPanelStyles';\nimport {SortConfig} from 'app/client/ui/SortConfig';\nimport {basicButton, primaryButton} from 'app/client/ui2018/buttons';\nimport {Computed, Disposable, dom, makeTestId, styled} from 'grainjs';\n\nconst testId = makeTestId('test-sort-filter-config-');\n\nconst t = makeT('SortFilterConfig');\n\nexport class SortFilterConfig extends Disposable {\n  private _docModel = this._gristDoc.docModel;\n  private _isReadonly = this._gristDoc.isReadonly;\n\n  private _hasChanges: Computed<boolean> = Computed.create(this, (use) => (\n    use(this._section.filterSpecChanged) || !use(this._section.activeSortJson.isSaved)\n  ));\n\n  constructor(private _section: ViewSectionRec, private _gristDoc: GristDoc) {\n    super();\n  }\n\n  public buildDom() {\n    return [\n      cssLabel(t('Sort')),\n      dom.create(SortConfig, this._section, this._gristDoc, {\n        menuOptions: {attach: 'body'},\n      }),\n      cssLabel(t('Filter')),\n      dom.create(FilterConfig, this._section, {\n        menuOptions: {attach: 'body'},\n      }),\n      dom.maybe(this._hasChanges, () => [\n        cssSaveButtonsRow(\n          cssSaveButton(t('Save'),\n            dom.on('click', () => this._save()),\n            dom.boolAttr('disabled', this._isReadonly),\n            testId('save'),\n          ),\n          basicButton(t('Revert'),\n            dom.on('click', () => this._revert()),\n            testId('revert'),\n          ),\n          testId('save-btns'),\n        ),\n      ]),\n    ];\n  }\n\n  private async _save() {\n    await this._docModel.docData.bundleActions(t('Update Sort & Filter settings'), () => Promise.all([\n      this._section.activeSortJson.save(),\n      this._section.saveFilters(),\n    ]));\n  }\n\n  private _revert() {\n    this._section.activeSortJson.revert();\n    this._section.revertFilters();\n  }\n}\n\nconst cssSaveButton = styled(primaryButton, `\n  margin-right: 8px;\n`);\n","var _ = require('underscore');\nvar ko = require('knockout');\nvar dispose = require('../lib/dispose');\nvar dom = require('../lib/dom');\nvar kd = require('../lib/koDom');\nvar kf = require('../lib/koForm');\nvar koArray = require('../lib/koArray');\nvar commands = require('./commands');\nvar {CustomSectionElement} = require('../lib/CustomSectionElement');\nconst {ChartConfig} = require('./ChartView');\nconst {Computed, dom: grainjsDom, makeTestId} = require('grainjs');\n\nconst {cssRow} = require('app/client/ui/RightPanelStyles');\nconst {SortFilterConfig} = require('app/client/ui/SortFilterConfig');\nconst {primaryButton} = require('app/client/ui2018/buttons');\nconst {select} = require('app/client/ui2018/menus');\nconst {confirmModal} = require('app/client/ui2018/modals');\nconst {makeT} = require('app/client/lib/localization');\n\nconst testId = makeTestId('test-vconfigtab-');\n\nconst t = makeT('ViewConfigTab');\n\n/**\n * Helper class that combines one ViewSection's data for building dom.\n */\nfunction ViewSectionData(section) {\n  this.section = section;\n\n  // A koArray reflecting the columns (RowModels) that are not present in the current view.\n  this.hiddenFields = this.autoDispose(koArray.syncedKoArray(section.hiddenColumns));\n}\ndispose.makeDisposable(ViewSectionData);\n\n\nfunction ViewConfigTab(options) {\n  var self = this;\n  this.gristDoc = options.gristDoc;\n  this.viewModel = options.viewModel;\n\n  // viewModel may point to different views, but viewSectionData is a single koArray reflecting\n  // the sections of the current view.\n  this.viewSectionData = this.autoDispose(\n    koArray.syncedKoArray(this.viewModel.viewSections, function(section) {\n      return ViewSectionData.create(section);\n    })\n    .setAutoDisposeValues()\n  );\n\n  this.isDetail = this.autoDispose(ko.computed(function() {\n    return ['detail', 'single'].includes(this.viewModel.activeSection().parentKey());\n  }, this));\n  this.isChart = this.autoDispose(ko.computed(function() {\n    return this.viewModel.activeSection().parentKey() === 'chart';}, this));\n  this.isGrid = this.autoDispose(ko.computed(function() {\n    return this.viewModel.activeSection().parentKey() === 'record';}, this));\n  this.isCustom = this.autoDispose(ko.computed(function() {\n    return this.viewModel.activeSection().parentKey() === 'custom';}, this));\n  this.isRaw = this.autoDispose(ko.computed(function() {\n    return this.viewModel.activeSection().isRaw();}, this));\n\n  this.activeRawSectionData = this.autoDispose(ko.computed(function() {\n    return self.isRaw() ? ViewSectionData.create(self.viewModel.activeSection()) : null;\n  }));\n\n  this.activeSectionData = this.autoDispose(ko.computed(function() {\n    return (\n      _.find(self.viewSectionData.all(), function(sectionData) {\n        return sectionData.section &&\n          sectionData.section.getRowId() === self.viewModel.activeSectionId();\n      })\n      || self.activeRawSectionData()\n      || self.viewSectionData.at(0)\n    );\n  }));\n}\ndispose.makeDisposable(ViewConfigTab);\n\n\nViewConfigTab.prototype.buildSortFilterDom = function() {\n  return grainjsDom.maybe(this.activeSectionData, ({section}) => {\n    return grainjsDom.create(SortFilterConfig, section, this.gristDoc);\n  });\n};\n\nViewConfigTab.prototype._makeOnDemand = function(table) {\n  // After saving the changed setting, force the reload of the document.\n  const onConfirm = () => {\n    return table.onDemand.saveOnly(!table.onDemand.peek())\n    .then(() => {\n      return this.gristDoc.docComm.reloadDoc()\n      .catch((err) => {\n        // Ignore the expected error from the socket shutdown that we asked for.\n        if (!err.message.includes('GristWSConnection disposed')) {\n          throw err;\n        }\n      })\n    });\n  }\n\n  if (table.onDemand()) {\n    confirmModal('Unmark table On-Demand?', 'Unmark On-Demand', onConfirm, {\n      explanation: dom('div', 'If you unmark table ', dom('b', table), ' as On-Demand, ' +\n        'its data will be loaded into the calculation engine and will be available ' +\n        'for use in formulas. For a big table, this may greatly increase load times.',\n        dom('br'), dom('br'), 'Changing this setting will reload the document for all users.'),\n    });\n  } else {\n    confirmModal('Make table On-Demand?', 'Make On-Demand', onConfirm, {\n      explanation: dom('div', 'If you make table ', dom('b', table), ' On-Demand, ' +\n        'its data will no longer be loaded into the calculation engine and will not be available ' +\n        'for use in formulas. It will remain available for viewing and editing.',\n        dom('br'), dom('br'), 'Changing this setting will reload the document for all users.'),\n    });\n  }\n};\n\nViewConfigTab.prototype._buildAdvancedSettingsDom = function() {\n  return kd.maybe(() => {\n    const s = this.activeSectionData();\n    return s && !s.section.table().summarySourceTable() ? s : null;\n  }, (sectionData) => {\n\n    const table = sectionData.section.table();\n    const isCollapsed = ko.observable(true);\n    return [\n      kf.collapserLabel(isCollapsed, t(\"Advanced settings\"), dom.testId('ViewConfig_advanced')),\n      kf.helpRow(kd.hide(isCollapsed),\n        t(\"Big tables may be marked as \\\"on-demand\\\" to avoid loading them into the data engine.\"),\n        kd.style('text-align', 'left'),\n        kd.style('margin-top', '1.5rem')\n      ),\n      kf.row(kd.hide(isCollapsed),\n        kf.label('Table ', dom('b', kd.text(table.tableId)), ':')\n      ),\n      kf.row(kd.hide(isCollapsed),\n        kf.buttonGroup(kf.button(() => this._makeOnDemand(table),\n          kd.text(() => table.onDemand() ? t(\"Unmark On-Demand\") : t(\"Make On-Demand\")),\n          dom.testId('ViewConfig_onDemandBtn')\n        ))\n      ),\n    ];\n  });\n};\n\nViewConfigTab.prototype._buildThemeDom = function() {\n  return kd.maybe(this.activeSectionData, (sectionData) => {\n    var section = sectionData.section;\n    if (this.isDetail()) {\n      const theme = Computed.create(null, (use) => use(section.themeDef));\n      theme.onWrite(val => section.themeDef.setAndSave(val));\n      return cssRow(\n        dom.autoDispose(theme),\n        select(theme, [\n          {label: t(\"Form\"),        value: 'form'   },\n          {label: t(\"Compact\"),     value: 'compact'},\n          {label: t(\"Blocks\"),      value: 'blocks'  },\n        ]),\n        testId('detail-theme')\n      );\n    }\n  });\n};\n\nViewConfigTab.prototype._buildChartConfigDom = function() {\n  return grainjsDom.maybe(this.viewModel.activeSection, (section) => grainjsDom.create(ChartConfig, this.gristDoc, section));\n};\n\nViewConfigTab.prototype._buildLayoutDom = function() {\n  return kd.maybe(this.activeSectionData, (sectionData) => {\n    if (this.isDetail()) {\n      const view = sectionData.section.viewInstance.peek();\n      const layoutEditorObs = ko.computed(() => view && view.recordLayout && view.recordLayout.layoutEditor());\n      return cssRow({style: 'margin-top: 16px;'},\n        kd.maybe(layoutEditorObs, (editor) => editor.buildFinishButtons()),\n        primaryButton(t(\"Edit Card Layout\"),\n          dom.autoDispose(layoutEditorObs),\n          dom.on('click', () => commands.allCommands.editLayout.run()),\n          grainjsDom.hide(layoutEditorObs),\n          grainjsDom.cls('behavioral-prompt-edit-card-layout'),\n          testId('detail-edit-layout'),\n        )\n      );\n    }\n  });\n};\n\n/**\n * Builds the three items for configuring a `Custom View`:\n *  1) Mode picker: let user choose between 'url' and 'plugin' mode\n *  2) Show if 'url' mode: let user enter the url\n *  3) Show if 'plugin' mode: let user pick a plugin and a section from the list of available plugin.\n */\nViewConfigTab.prototype._buildCustomTypeItems = function() {\n  const docPluginManager = this.gristDoc.docPluginManager;\n  const activeSection = this.viewModel.activeSection;\n\n  // all available custom sections grouped by their plugin id\n  const customSections = _.groupBy(CustomSectionElement.getSections(docPluginManager.pluginsList), s => s.pluginId);\n\n  // all plugin ids which have custom sections\n  const allPlugins = Object.keys(customSections);\n\n  // the list of customSections of the selected plugin (computed)\n  const customSectionIds = ko.pureComputed(() => {\n    const sections = customSections[this.viewModel.activeSection().customDef.pluginId()] || [];\n    return sections.map(({sectionId}) => sectionId);\n  });\n\n  return [{\n\n    // 1)\n    buildDom: () => kd.scope(activeSection, ({customDef}) => kf.buttonSelect(customDef.mode,\n      kf.optionButton('url', 'URL', dom.testId('ViewConfigTab_customView_url')),\n      kf.optionButton('plugin', 'Plugin', dom.testId('ViewConfigTab_customView_plugin'))))\n  }, {\n\n    // 2)\n    // TODO: refactor this part, Custom Widget moved to separate file.\n  }, {\n\n    // 3)\n    showObs: () => activeSection().customDef.mode() === \"plugin\",\n    buildDom: () => kd.scope(activeSection, ({customDef}) => dom('div',\n      kf.row(5, t(\"Plugin: \"), 13, kf.text(customDef.pluginId, {}, {list: \"list_plugin\"}, dom.testId('ViewConfigTab_customView_pluginId'))),\n      kf.row(5, t(\"Section: \"), 13, kf.text(customDef.sectionId, {}, {list: \"list_section\"},  dom.testId('ViewConfigTab_customView_sectionId'))),\n      // For both `customPlugin` and `selectedSection` it is possible for the value not to be in the\n      // list of options. Combining <datalist> and <input> allows both to freely edit the value with\n      // keyboard and to select it from a list. Although the content of the list seems to be\n      // filtered by the current value, which could confuse user into thinking that there are no\n      // available options. I think it would be better to have the full list always, but it seems\n      // harder to accomplish and is left as a TODO.\n      dom('datalist#list_plugin',  kd.foreach(koArray(allPlugins), value => dom('option', {value}))),\n      dom('datalist#list_section', kd.scope(customSectionIds, sections => kd.foreach(koArray(sections), (value) => dom('option', {value}))))\n      ))\n  }];\n};\n\nmodule.exports = ViewConfigTab;\n"],"names":[],"sourceRoot":""}