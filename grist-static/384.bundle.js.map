{"version":3,"file":"384.bundle.js","mappings":"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","sources":["./app/client/ui/AccountPageCss.ts?","./app/client/ui/ApiKey.ts?","./stubs/app/client/ui/MFAConfig.ts?","./app/client/ui/ThemeConfig.ts?","./app/client/ui/AccountPage.ts?","./stubs/app/client/ui/ChangePasswordDialog.ts?","./app/client/ui/transientInput.ts?"],"sourcesContent":["import {theme, vars} from 'app/client/ui2018/cssVars';\nimport {icon as gristIcon} from 'app/client/ui2018/icons';\nimport {styled} from 'grainjs';\n\nexport const container = styled('div', `\n  display: flex;\n  justify-content: center;\n  overflow: auto;\n`);\n\nexport const accountPage = styled('div', `\n  max-width: 600px;\n  margin-top: auto;\n  margin-bottom: auto;\n  padding: 16px;\n`);\n\nexport const content = styled('div', `\n  flex: 1 1 300px;\n`);\n\nexport const textBtn = styled('button', `\n  font-size: ${vars.mediumFontSize};\n  color: ${theme.controlFg};\n  cursor: pointer;\n  margin-left: 16px;\n  background-color: transparent;\n  border: none;\n  padding: 0;\n  text-align: left;\n  min-width: 110px;\n\n  &:hover {\n    color: ${theme.controlHoverFg};\n  }\n`);\n\nexport const icon = styled(gristIcon, `\n  background-color: ${theme.controlFg};\n  margin: 0 4px 2px 0;\n\n  .${textBtn.className}:hover > & {\n    background-color: ${theme.controlHoverFg};\n  }\n`);\n\nexport const description = styled('div', `\n  color: ${theme.lightText};\n  font-size: 13px;\n`);\n\nexport const flexGrow = styled('div', `\n  flex-grow: 1;\n`);\n\nexport const name = styled(flexGrow, `\n  color: ${theme.text};\n  word-break: break-word;\n`);\n\nexport const email = styled('div', `\n  color: ${theme.text};\n  word-break: break-word;\n`);\n\nexport const loginMethod = styled(flexGrow, `\n  color: ${theme.text};\n  word-break: break-word;\n`);\n\nexport const warning = styled('div', `\n  color: ${theme.errorText};\n`);\n\nexport const header = styled('div', `\n  height: 32px;\n  line-height: 32px;\n  margin: 28px 0 16px 0;\n  color: ${theme.text};\n  font-size: ${vars.xxxlargeFontSize};\n  font-weight: ${vars.headerControlTextWeight};\n`);\n\nexport const subHeader = styled('div', `\n  color: ${theme.text};\n  padding: 8px 0;\n  vertical-align: top;\n  font-weight: bold;\n  display: block;\n`);\n\nexport const inlineSubHeader = styled(subHeader, `\n  display: inline-block;\n  min-width: 110px;\n`);\n\nexport const dataRow = styled('div', `\n  margin: 8px 0px;\n  display: flex;\n  align-items: baseline;\n  gap: 2px;\n`);\n\nexport const betaTag = styled('span', `\n  text-transform: uppercase;\n  vertical-align: super;\n  font-size: ${vars.xsmallFontSize};\n  color: ${theme.accentText};\n`);\n","import { makeT } from 'app/client/lib/localization';\nimport { basicButton, textButton } from 'app/client/ui2018/buttons';\nimport { theme, vars } from 'app/client/ui2018/cssVars';\nimport { icon } from 'app/client/ui2018/icons';\nimport { confirmModal } from 'app/client/ui2018/modals';\nimport { Disposable, dom, IDomArgs, makeTestId, Observable, observable, styled } from 'grainjs';\n\nconst t = makeT('ApiKey');\n\ninterface IWidgetOptions {\n  apiKey: Observable<string>;\n  onDelete: () => Promise<void>;\n  onCreate: () => Promise<void>;\n  anonymous?: boolean; // Configure appearance and available options for anonymous use.\n                       // When anonymous, no modifications are permitted to profile information.\n                       // TODO: add browser test for this option.\n  inputArgs?: IDomArgs<HTMLInputElement>;\n}\n\nconst testId = makeTestId('test-apikey-');\n\n/**\n * ApiKey component shows an api key with controls to change it. Expects `options.apiKey` the api\n * key and shows it if value is truthy along with a 'Delete' button that triggers the\n * `options.onDelete` callback. When `options.apiKey` is falsy, hides it and show a 'Create' button\n * that triggers the `options.onCreate` callback. It is the responsibility of the caller to update\n * the `options.apiKey` to its new value.\n */\nexport class ApiKey extends Disposable {\n  private _apiKey: Observable<string>;\n  private _onDeleteCB: () => Promise<void>;\n  private _onCreateCB: () => Promise<void>;\n  private _anonymous: boolean;\n  private _inputArgs: IDomArgs<HTMLInputElement>;\n  private _loading = observable(false);\n  private _isHidden: Observable<boolean> = Observable.create(this, true);\n\n  constructor(options: IWidgetOptions) {\n    super();\n    this._apiKey = options.apiKey;\n    this._onDeleteCB = options.onDelete;\n    this._onCreateCB = options.onCreate;\n    this._anonymous = Boolean(options.anonymous);\n    this._inputArgs = options.inputArgs ?? [];\n  }\n\n  public buildDom() {\n    return dom('div', testId('container'), dom.style('position', 'relative'),\n      dom.maybe(this._apiKey, (apiKey) => dom('div',\n        cssRow(\n          cssInput(\n            {\n              readonly: true,\n              value: this._apiKey.get(),\n            },\n            dom.attr('type', (use) => use(this._isHidden) ? 'password' : 'text'),\n            testId('key'),\n            {title: t(\"Click to show\")},\n            dom.on('click', (_ev, el) => {\n              this._isHidden.set(false);\n              setTimeout(() => el.select(), 0);\n            }),\n            dom.on('blur', (ev) => {\n              // Hide the key when it is no longer selected.\n              if (ev.target !== document.activeElement) { this._isHidden.set(true); }\n            }),\n            this._inputArgs\n          ),\n          cssTextBtn(\n            cssTextBtnIcon('Remove'), t(\"Remove\"),\n            dom.on('click', () => this._showRemoveKeyModal()),\n            testId('delete'),\n            dom.boolAttr('disabled', (use) => use(this._loading) || this._anonymous)\n          ),\n        ),\n        description(this._getDescription(), testId('description')),\n      )),\n      dom.maybe((use) => !(use(this._apiKey) || this._anonymous), () => [\n        basicButton(t(\"Create\"), dom.on('click', () => this._onCreate()), testId('create'),\n          dom.boolAttr('disabled', this._loading)),\n        description(t(\"By generating an API key, you will be able to \\\nmake API calls for your own account.\"), testId('description')),\n      ]),\n    );\n  }\n\n  // Switch the `_loading` flag to `true` and later, once promise resolves, switch it back to\n  // `false`.\n  private async _switchLoadingFlag(promise: Promise<any>) {\n    this._loading.set(true);\n    try {\n      await promise;\n    } finally {\n      this._loading.set(false);\n    }\n  }\n\n  private _onDelete(): Promise<void> {\n    return this._switchLoadingFlag(this._onDeleteCB());\n  }\n\n  private _onCreate(): Promise<void> {\n    return this._switchLoadingFlag(this._onCreateCB());\n  }\n\n  private _getDescription(): string {\n    return t(\n      !this._anonymous ?\n        'This API key can be used to access your account via the API. Don’t share your API key with anyone.' :\n        'This API key can be used to access this account anonymously via the API.'\n    );\n  }\n\n  private _showRemoveKeyModal(): void {\n    confirmModal(\n      t(\"Remove API Key\"), t(\"Remove\"),\n      () => this._onDelete(),\n      {\n        explanation: t(\n          \"You're about to delete an API key. This will cause all future requests \\\nusing this API key to be rejected. Do you still want to delete?\"\n        ),\n      }\n    );\n  }\n}\n\nconst description = styled('div', `\n  margin-top: 8px;\n  color: ${theme.lightText};\n  font-size: ${vars.mediumFontSize};\n`);\n\nconst cssInput = styled('input', `\n  background-color: transparent;\n  color: ${theme.inputFg};\n  border: 1px solid ${theme.inputBorder};\n  padding: 4px;\n  border-radius: 3px;\n  outline: none;\n  flex: 1 0 0;\n`);\n\nconst cssRow = styled('div', `\n  display: flex;\n`);\n\nconst cssTextBtn = styled(textButton, `\n  text-align: left;\n  width: 90px;\n  margin-left: 16px;\n`);\n\nconst cssTextBtnIcon = styled(icon, `\n  margin: 0 4px 2px 0;\n`);\n","import {FullUser} from 'app/common/UserAPI';\nimport {Disposable} from 'grainjs';\n\nexport class MFAConfig extends Disposable {\n  constructor(_user: FullUser) { super(); }\n\n  public buildDom() { return null; }\n}\n","import {makeT} from 'app/client/lib/localization';\nimport {AppModel} from 'app/client/models/AppModel';\nimport * as css from 'app/client/ui/AccountPageCss';\nimport {labeledSquareCheckbox} from 'app/client/ui2018/checkbox';\nimport {select} from 'app/client/ui2018/menus';\nimport {ThemeAppearance} from 'app/common/ThemePrefs';\nimport {Computed, Disposable, dom, makeTestId, styled} from 'grainjs';\n\nconst testId = makeTestId('test-theme-config-');\nconst t = makeT('ThemeConfig');\n\nexport class ThemeConfig extends Disposable {\n  private _themePrefs = this._appModel.themePrefs;\n\n  private _appearance = Computed.create(this, this._themePrefs, (_use, prefs) => {\n    return prefs.appearance;\n  }).onWrite((value) => this._updateAppearance(value));\n\n  private _syncWithOS = Computed.create(this, this._themePrefs, (_use, prefs) => {\n    return prefs.syncWithOS;\n  }).onWrite((value) => this._updateSyncWithOS(value));\n\n  constructor(private _appModel: AppModel) {\n    super();\n  }\n\n  public buildDom() {\n    return dom('div',\n      css.subHeader(t(\"Appearance \"), css.betaTag('Beta')),\n      css.dataRow(\n        cssAppearanceSelect(\n          select(\n            this._appearance,\n            [\n              {value: 'light', label: 'Light'},\n              {value: 'dark', label: 'Dark'},\n            ],\n          ),\n          testId('appearance'),\n        ),\n      ),\n      css.dataRow(\n        labeledSquareCheckbox(\n          this._syncWithOS,\n          t(\"Switch appearance automatically to match system\"),\n          testId('sync-with-os'),\n        ),\n      ),\n      testId('container'),\n    );\n  }\n\n  private _updateAppearance(appearance: ThemeAppearance) {\n    this._themePrefs.set({...this._themePrefs.get(), appearance});\n  }\n\n  private _updateSyncWithOS(syncWithOS: boolean) {\n    this._themePrefs.set({...this._themePrefs.get(), syncWithOS});\n  }\n}\n\nconst cssAppearanceSelect = styled('div', `\n  width: 120px;\n`);\n","import {AppModel, reportError} from 'app/client/models/AppModel';\nimport {urlState} from 'app/client/models/gristUrlState';\nimport * as css from 'app/client/ui/AccountPageCss';\nimport {ApiKey} from 'app/client/ui/ApiKey';\nimport {AppHeader} from 'app/client/ui/AppHeader';\nimport {buildChangePasswordDialog} from 'app/client/ui/ChangePasswordDialog';\nimport {leftPanelBasic} from 'app/client/ui/LeftPanelCommon';\nimport {MFAConfig} from 'app/client/ui/MFAConfig';\nimport {pagePanels} from 'app/client/ui/PagePanels';\nimport {ThemeConfig} from 'app/client/ui/ThemeConfig';\nimport {createTopBarHome} from 'app/client/ui/TopBar';\nimport {transientInput} from 'app/client/ui/transientInput';\nimport {cssBreadcrumbs, separator} from 'app/client/ui2018/breadcrumbs';\nimport {labeledSquareCheckbox} from 'app/client/ui2018/checkbox';\nimport {cssLink} from 'app/client/ui2018/links';\nimport {select} from 'app/client/ui2018/menus';\nimport {getGristConfig} from 'app/common/urlUtils';\nimport {FullUser} from 'app/common/UserAPI';\nimport {detectCurrentLang, makeT} from 'app/client/lib/localization';\nimport {translateLocale} from 'app/client/ui/LanguageMenu';\nimport {Computed, Disposable, dom, domComputed, makeTestId, Observable, styled} from 'grainjs';\n\nconst testId = makeTestId('test-account-page-');\nconst t = makeT('AccountPage');\n\n/**\n * Creates the account page where a user can manage their profile settings.\n */\nexport class AccountPage extends Disposable {\n  private _apiKey = Observable.create<string>(this, '');\n  private _userObs = Observable.create<FullUser|null>(this, null);\n  private _isEditingName = Observable.create(this, false);\n  private _nameEdit = Observable.create<string>(this, '');\n  private _isNameValid = Computed.create(this, this._nameEdit, (_use, val) => checkName(val));\n  private _allowGoogleLogin = Computed.create(this, (use) => use(this._userObs)?.allowGoogleLogin ?? false)\n    .onWrite((val) => this._updateAllowGooglelogin(val));\n\n  constructor(private _appModel: AppModel) {\n    super();\n    this._fetchAll().catch(reportError);\n  }\n\n  public buildDom() {\n    const panelOpen = Observable.create(this, false);\n    return pagePanels({\n      leftPanel: {\n        panelWidth: Observable.create(this, 240),\n        panelOpen,\n        hideOpener: true,\n        header: dom.create(AppHeader, this._appModel),\n        content: leftPanelBasic(this._appModel, panelOpen),\n      },\n      headerMain: this._buildHeaderMain(),\n      contentMain: this._buildContentMain(),\n      testId,\n    });\n  }\n\n  private _buildContentMain() {\n    const {enableCustomCss} = getGristConfig();\n    const supportedLngs = getGristConfig().supportedLngs ?? ['en'];\n    const languageOptions = supportedLngs\n      .map((lng) => ({value: lng, label: translateLocale(lng)!}))\n      .sort((a, b) => a.value.localeCompare(b.value));\n\n    const userLocale = Computed.create(this, use => {\n      const selected = detectCurrentLang();\n      if (!supportedLngs.includes(selected)) { return 'en'; }\n      return selected;\n    });\n    userLocale.onWrite(async value => {\n      await this._appModel.api.updateUserLocale(value || null);\n      // Reload the page to apply the new locale.\n      window.location.reload();\n    });\n\n    return domComputed(this._userObs, (user) => user && (\n      css.container(css.accountPage(\n        css.header(t(\"Account settings\")),\n        css.dataRow(\n          css.inlineSubHeader(t(\"Email\")),\n          css.email(user.email),\n        ),\n        css.dataRow(\n          css.inlineSubHeader(t(\"Name\")),\n          domComputed(this._isEditingName, (isEditing) => (\n            isEditing ? [\n              transientInput(\n                {\n                  initialValue: user.name,\n                  save: (val) => this._isNameValid.get() && this._updateUserName(val),\n                  close: () => { this._isEditingName.set(false); this._nameEdit.set(''); },\n                },\n                {size: '5'}, // Lower size so that input can shrink below ~152px.\n                dom.on('input', (_ev, el) => this._nameEdit.set(el.value)),\n                css.flexGrow.cls(''),\n              ),\n              css.textBtn(\n                css.icon('Settings'), t(\"Save\"),\n                // No need to save on 'click'. The transient input already does it on close.\n              ),\n            ] : [\n              css.name(user.name),\n              css.textBtn(\n                css.icon('Settings'), t(\"Edit\"),\n                dom.on('click', () => this._isEditingName.set(true)),\n              ),\n            ]\n          )),\n          testId('username'),\n        ),\n        // show warning for invalid name but not for the empty string\n        dom.maybe(use => use(this._nameEdit) && !use(this._isNameValid), this._buildNameWarningsDom.bind(this)),\n        css.header(t(\"Password & Security\")),\n        css.dataRow(\n          css.inlineSubHeader(t(\"Login Method\")),\n          css.loginMethod(user.loginMethod),\n          user.loginMethod === 'Email + Password' ? css.textBtn(t(\"Change Password\"),\n            dom.on('click', () => this._showChangePasswordDialog()),\n          ) : null,\n          testId('login-method'),\n        ),\n        user.loginMethod !== 'Email + Password' ? null : dom.frag(\n          css.dataRow(\n            labeledSquareCheckbox(\n              this._allowGoogleLogin,\n              t(\"Allow signing in to this account with Google\"),\n              testId('allow-google-login-checkbox'),\n            ),\n            testId('allow-google-login'),\n          ),\n          css.subHeader(t(\"Two-factor authentication\")),\n          css.description(\n            t(\"Two-factor authentication is an extra layer of security for your Grist account \\\ndesigned to ensure that you're the only person who can access your account, even if someone knows your password.\")\n          ),\n          dom.create(MFAConfig, user),\n        ),\n        css.header(t(\"Theme\")),\n        // Custom CSS is incompatible with custom themes.\n        enableCustomCss ? null : dom.create(ThemeConfig, this._appModel),\n        css.subHeader(t(\"Language\")),\n        css.dataRow({ style: 'width: 300px'},\n          select(userLocale, languageOptions, {\n            renderOptionArgs: () => {\n              return dom.cls(cssFirstUpper.className);\n            }\n          }),\n          testId('language'),\n        ),\n        css.header(t(\"API\")),\n        css.dataRow(css.inlineSubHeader(t(\"API Key\")), css.content(\n          dom.create(ApiKey, {\n            apiKey: this._apiKey,\n            onCreate: () => this._createApiKey(),\n            onDelete: () => this._deleteApiKey(),\n            anonymous: false,\n            inputArgs: [{size: '5'}], // Lower size so that input can shrink below ~152px.\n          })\n        )),\n      ),\n      testId('body'),\n    )));\n  }\n\n  private _buildHeaderMain() {\n    return dom.frag(\n      cssBreadcrumbs({style: 'margin-left: 16px;'},\n        cssLink(\n          urlState().setLinkUrl({}),\n          'Home',\n          testId('home'),\n        ),\n        separator(' / '),\n        dom('span', 'Account'),\n      ),\n      createTopBarHome(this._appModel),\n    );\n  }\n\n  private async _fetchApiKey() {\n    this._apiKey.set(await this._appModel.api.fetchApiKey());\n  }\n\n  private async _createApiKey() {\n    this._apiKey.set(await this._appModel.api.createApiKey());\n  }\n\n  private async _deleteApiKey() {\n    await this._appModel.api.deleteApiKey();\n    this._apiKey.set('');\n  }\n\n  private async _fetchUserProfile() {\n    this._userObs.set(await this._appModel.api.getUserProfile());\n  }\n\n  private async _fetchAll() {\n    await Promise.all([\n      this._fetchApiKey(),\n      this._fetchUserProfile(),\n    ]);\n  }\n\n  private async _updateUserName(val: string) {\n    const user = this._userObs.get();\n    if (user && val && val === user.name) { return; }\n\n    await this._appModel.api.updateUserName(val);\n    await this._fetchAll();\n  }\n\n  private async _updateAllowGooglelogin(allowGoogleLogin: boolean) {\n    await this._appModel.api.updateAllowGoogleLogin(allowGoogleLogin);\n    await this._fetchUserProfile();\n  }\n\n  private _showChangePasswordDialog() {\n    return buildChangePasswordDialog();\n  }\n\n  /**\n  * Builds dom to show marning messages to the user.\n  */\n  private _buildNameWarningsDom() {\n    return cssWarnings(\n      t(\"Names only allow letters, numbers and certain special characters\"),\n      testId('username-warning'),\n    );\n  }\n}\n\n/**\n * We allow alphanumeric characters and certain common whitelisted characters (except at the start),\n * plus everything non-ASCII (for non-English alphabets, which we want to allow but it's hard to be\n * more precise about what exactly to allow).\n */\n// eslint-disable-next-line no-control-regex\nconst VALID_NAME_REGEXP = /^(\\w|[^\\u0000-\\u007F])(\\w|[- ./'\"()]|[^\\u0000-\\u007F])*$/;\n\n/**\n * Test name against various rules to check if it is a valid username.\n */\nexport function checkName(name: string): boolean {\n  return VALID_NAME_REGEXP.test(name);\n}\n\n\n\nconst cssWarnings = styled(css.warning, `\n  margin: -8px 0 0 110px;\n`);\n\nconst cssFirstUpper = styled('div', `\n  & > div::first-letter {\n    text-transform: capitalize;\n  }\n`);\n","export function buildChangePasswordDialog() {\n  return null;\n}\n","/**\n * This is a temporary <input> element. The intended usage is to create is when needed (e.g. when\n * some \"rename\" option is chosen), and provide methods to save and to close.\n *\n * It calls save() on Enter and on blur, which should return a Promise. On successful save, and on\n * Escape, it calls close(), which should destroy the <input>.\n */\n\nimport {reportError} from 'app/client/models/AppModel';\nimport {theme} from 'app/client/ui2018/cssVars';\nimport {dom, DomArg, styled} from 'grainjs';\n\nexport interface ITransientInputOptions {\n  initialValue: string;\n  save(value: string): Promise<void>|any;\n  close(): void;\n}\n\nexport function transientInput({initialValue, save, close}: ITransientInputOptions,\n                               ...args: Array<DomArg<HTMLInputElement>>) {\n  let lastSave: string = initialValue;\n\n  async function onSave(explicitSave: boolean) {\n    try {\n      if (explicitSave || input.value !== lastSave) {\n        lastSave = input.value;\n        await save(input.value);\n      }\n      close();\n    } catch (err) {\n      reportError(err);\n      delayedFocus();\n    }\n  }\n\n  function delayedFocus() {\n    setTimeout(() => { input.focus(); input.select(); }, 10);\n  }\n\n  const input = cssInput({type: 'text', placeholder: 'Enter name'},\n    dom.prop('value', initialValue),\n    dom.on('blur', () => onSave(false)),\n    dom.onKeyDown({\n      Enter: () => onSave(true),\n      Escape: () => close(),\n    }),\n    ...args,\n  );\n  delayedFocus();\n  return input;\n}\n\nconst cssInput = styled('input', `\n  background-color: transparent;\n  color: ${theme.inputFg};\n\n  &::placeholder {\n    color: ${theme.inputPlaceholderFg};\n  }\n`);\n"],"names":["container","styled","accountPage","content","textBtn","vars","theme","icon","className","description","flexGrow","email","loginMethod","warning","header","subHeader","inlineSubHeader","dataRow","betaTag","t","makeT","testId","makeTestId","ApiKey","Disposable","constructor","options","super","_loading","observable","_isHidden","Observable","this","_apiKey","apiKey","_onDeleteCB","onDelete","_onCreateCB","onCreate","_anonymous","Boolean","anonymous","_inputArgs","inputArgs","dom","cssRow","cssInput","readonly","value","get","use","title","_ev","el","set","setTimeout","select","ev","target","document","activeElement","cssTextBtn","cssTextBtnIcon","_showRemoveKeyModal","_getDescription","basicButton","_onCreate","promise","_switchLoadingFlag","confirmModal","_onDelete","explanation","textButton","MFAConfig","_user","ThemeConfig","_appModel","_themePrefs","themePrefs","_appearance","Computed","_use","prefs","appearance","onWrite","_updateAppearance","_syncWithOS","syncWithOS","_updateSyncWithOS","cssAppearanceSelect","label","AccountPage","_userObs","_isEditingName","_nameEdit","_isNameValid","val","checkName","_allowGoogleLogin","allowGoogleLogin","_updateAllowGooglelogin","_fetchAll","catch","panelOpen","leftPanel","panelWidth","hideOpener","AppHeader","headerMain","_buildHeaderMain","contentMain","_buildContentMain","enableCustomCss","getGristConfig","supportedLngs","languageOptions","map","lng","sort","a","b","localeCompare","userLocale","selected","detectCurrentLang","includes","async","api","updateUserLocale","window","location","reload","domComputed","user","isEditing","transientInput","initialValue","name","save","_updateUserName","close","size","_buildNameWarningsDom","bind","_showChangePasswordDialog","style","renderOptionArgs","cssFirstUpper","_createApiKey","_deleteApiKey","urlState","setLinkUrl","fetchApiKey","createApiKey","deleteApiKey","getUserProfile","Promise","all","_fetchApiKey","_fetchUserProfile","updateUserName","updateAllowGoogleLogin","cssWarnings","VALID_NAME_REGEXP","test","args","lastSave","explicitSave","input","err","delayedFocus","focus","type","placeholder","onSave","Enter","Escape"],"sourceRoot":""}