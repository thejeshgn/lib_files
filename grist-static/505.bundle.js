(self.webpackChunkgristy=self.webpackChunkgristy||[]).push([[505],{20505:(t,e,i)=>{"use strict";i.r(e),i.d(e,{ConditionalStyle:()=>a.o,FieldConfig:()=>n,ViewConfigTab:()=>s.a});var o=i(74667),s=i.n(o),n=i(3898),a=i(31825)},58965:(t,e,i)=>{"use strict";i.r(e),i.d(e,{SortFilterConfig:()=>u});var o=i(70387),s=i(91465),n=i(3411),a=i(21376),c=i(11187),r=i(1310);const l=(0,r.makeTestId)("test-sort-filter-config-"),d=(0,o.makeT)("SortFilterConfig");class u extends r.Disposable{constructor(t,e){super(),this._section=t,this._gristDoc=e,this._docModel=this._gristDoc.docModel,this._isReadonly=this._gristDoc.isReadonly,this._hasChanges=r.Computed.create(this,(t=>t(this._section.filterSpecChanged)||!t(this._section.activeSortJson.isSaved)))}buildDom(){return[(0,n.cssLabel)(d("Sort")),r.dom.create(a.m,this._section,this._gristDoc,{menuOptions:{attach:"body"}}),(0,n.cssLabel)(d("Filter")),r.dom.create(s.P,this._section,{menuOptions:{attach:"body"}}),r.dom.maybe(this._hasChanges,(()=>[(0,n.cssSaveButtonsRow)(m(d("Save"),r.dom.on("click",(()=>this._save())),r.dom.boolAttr("disabled",this._isReadonly),l("save")),(0,c.basicButton)(d("Revert"),r.dom.on("click",(()=>this._revert())),l("revert")),l("save-btns"))]))]}async _save(){await this._docModel.docData.bundleActions(d("Update Sort & Filter settings"),(()=>Promise.all([this._section.activeSortJson.save(),this._section.saveFilters()])))}_revert(){this._section.activeSortJson.revert(),this._section.revertFilters()}}const m=(0,r.styled)(c.primaryButton,"\n  margin-right: 8px;\n")},74667:(t,e,i)=>{var o=i(54156),s=i(29301),n=i(88438),a=i(81294),c=i(92979),r=i(73783),l=i(13988),d=i(77709),{CustomSectionElement:u}=i(59011);const{ChartConfig:m}=i(44747),{Computed:h,dom:p,makeTestId:b}=i(1310),{cssRow:v}=i(3411),{SortFilterConfig:g}=i(58965),{primaryButton:D}=i(11187),{select:f}=i(1370),{confirmModal:w}=i(20742),{makeT:y}=i(70387),_=b("test-vconfigtab-"),S=y("ViewConfigTab");function C(t){this.section=t,this.hiddenFields=this.autoDispose(l.syncedKoArray(t.hiddenColumns))}function k(t){var e=this;this.gristDoc=t.gristDoc,this.viewModel=t.viewModel,this.viewSectionData=this.autoDispose(l.syncedKoArray(this.viewModel.viewSections,(function(t){return C.create(t)})).setAutoDisposeValues()),this.isDetail=this.autoDispose(s.computed((function(){return["detail","single"].includes(this.viewModel.activeSection().parentKey())}),this)),this.isChart=this.autoDispose(s.computed((function(){return"chart"===this.viewModel.activeSection().parentKey()}),this)),this.isGrid=this.autoDispose(s.computed((function(){return"record"===this.viewModel.activeSection().parentKey()}),this)),this.isCustom=this.autoDispose(s.computed((function(){return"custom"===this.viewModel.activeSection().parentKey()}),this)),this.isRaw=this.autoDispose(s.computed((function(){return this.viewModel.activeSection().isRaw()}),this)),this.activeRawSectionData=this.autoDispose(s.computed((function(){return e.isRaw()?C.create(e.viewModel.activeSection()):null}))),this.activeSectionData=this.autoDispose(s.computed((function(){return o.find(e.viewSectionData.all(),(function(t){return t.section&&t.section.getRowId()===e.viewModel.activeSectionId()}))||e.activeRawSectionData()||e.viewSectionData.at(0)})))}n.makeDisposable(C),n.makeDisposable(k),k.prototype.buildSortFilterDom=function(){return p.maybe(this.activeSectionData,(({section:t})=>p.create(g,t,this.gristDoc)))},k.prototype._makeOnDemand=function(t){const e=()=>t.onDemand.saveOnly(!t.onDemand.peek()).then((()=>this.gristDoc.docComm.reloadDoc().catch((t=>{if(!t.message.includes("GristWSConnection disposed"))throw t}))));t.onDemand()?w("Unmark table On-Demand?","Unmark On-Demand",e,{explanation:a("div","If you unmark table ",a("b",t)," as On-Demand, its data will be loaded into the calculation engine and will be available for use in formulas. For a big table, this may greatly increase load times.",a("br"),a("br"),"Changing this setting will reload the document for all users.")}):w("Make table On-Demand?","Make On-Demand",e,{explanation:a("div","If you make table ",a("b",t)," On-Demand, its data will no longer be loaded into the calculation engine and will not be available for use in formulas. It will remain available for viewing and editing.",a("br"),a("br"),"Changing this setting will reload the document for all users.")})},k.prototype._buildAdvancedSettingsDom=function(){return c.maybe((()=>{const t=this.activeSectionData();return t&&!t.section.table().summarySourceTable()?t:null}),(t=>{const e=t.section.table(),i=s.observable(!0);return[r.collapserLabel(i,S("Advanced settings"),a.testId("ViewConfig_advanced")),r.helpRow(c.hide(i),S('Big tables may be marked as "on-demand" to avoid loading them into the data engine.'),c.style("text-align","left"),c.style("margin-top","1.5rem")),r.row(c.hide(i),r.label("Table ",a("b",c.text(e.tableId)),":")),r.row(c.hide(i),r.buttonGroup(r.button((()=>this._makeOnDemand(e)),c.text((()=>e.onDemand()?S("Unmark On-Demand"):S("Make On-Demand"))),a.testId("ViewConfig_onDemandBtn"))))]}))},k.prototype._buildThemeDom=function(){return c.maybe(this.activeSectionData,(t=>{var e=t.section;if(this.isDetail()){const t=h.create(null,(t=>t(e.themeDef)));return t.onWrite((t=>e.themeDef.setAndSave(t))),v(a.autoDispose(t),f(t,[{label:S("Form"),value:"form"},{label:S("Compact"),value:"compact"},{label:S("Blocks"),value:"blocks"}]),_("detail-theme"))}}))},k.prototype._buildChartConfigDom=function(){return p.maybe(this.viewModel.activeSection,(t=>p.create(m,this.gristDoc,t)))},k.prototype._buildLayoutDom=function(){return c.maybe(this.activeSectionData,(t=>{if(this.isDetail()){const e=t.section.viewInstance.peek(),i=s.computed((()=>e&&e.recordLayout&&e.recordLayout.layoutEditor()));return v({style:"margin-top: 16px;"},c.maybe(i,(t=>t.buildFinishButtons())),D(S("Edit Card Layout"),a.autoDispose(i),a.on("click",(()=>d.allCommands.editLayout.run())),p.hide(i),p.cls("behavioral-prompt-edit-card-layout"),_("detail-edit-layout")))}}))},k.prototype._buildCustomTypeItems=function(){const t=this.gristDoc.docPluginManager,e=this.viewModel.activeSection,i=o.groupBy(u.getSections(t.pluginsList),(t=>t.pluginId)),n=Object.keys(i),d=s.pureComputed((()=>(i[this.viewModel.activeSection().customDef.pluginId()]||[]).map((({sectionId:t})=>t))));return[{buildDom:()=>c.scope(e,(({customDef:t})=>r.buttonSelect(t.mode,r.optionButton("url","URL",a.testId("ViewConfigTab_customView_url")),r.optionButton("plugin","Plugin",a.testId("ViewConfigTab_customView_plugin")))))},{},{showObs:()=>"plugin"===e().customDef.mode(),buildDom:()=>c.scope(e,(({customDef:t})=>a("div",r.row(5,S("Plugin: "),13,r.text(t.pluginId,{},{list:"list_plugin"},a.testId("ViewConfigTab_customView_pluginId"))),r.row(5,S("Section: "),13,r.text(t.sectionId,{},{list:"list_section"},a.testId("ViewConfigTab_customView_sectionId"))),a("datalist#list_plugin",c.foreach(l(n),(t=>a("option",{value:t})))),a("datalist#list_section",c.scope(d,(t=>c.foreach(l(t),(t=>a("option",{value:t})))))))))}]},t.exports=k}}]);
//# sourceMappingURL=505.bundle.js.map